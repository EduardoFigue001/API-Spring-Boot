<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Carro de Compras - Ferremas</title>
  <link rel="stylesheet" href="estilos.css">
  <style>
    .hero {
      position: relative;
      height: 300px;
      overflow: hidden;
      border-radius: 16px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .hero video {
      position: absolute;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      transform: translate(-50%, -50%);
      object-fit: cover;
      z-index: 1;
    }

    .hero-texto {
      position: relative;
      z-index: 2;
      text-align: center;
      color: white;
      padding: 100px 20px 0;
      background: rgba(0,0,0,0.4);
      height: 100%;
    }

    .hero-texto h1 {
      font-size: 2.8em;
      margin: 0;
    }
  </style>
</head>
<body>

  <!-- Banner con video -->
  <div class="hero">
    <video autoplay muted loop>
      <source src="banner-ferremas.mp4.mp4" type="video/mp4">
      Tu navegador no soporta el video.
    </video>
    <div class="hero-texto">
      <h1>Carro de Compras</h1>
    </div>
  </div>

  <div class="grid" id="carro-contenido"></div>

  <div style="text-align: center; margin-top: 20px;">
    <h2 id="totalGeneral" style="color: #2c3e50;">Total: $0</h2>
  </div>

  <div class="filtros" style="margin-top: 30px;">
    <button onclick="finalizarCompra()">Finalizar Compra</button>
    <button onclick="vaciarCarro()">Vaciar Carro</button>
    <a href="catalogo.html"><button>Volver al Catálogo</button></a>
    <a href="index.html"><button>Volver al Inicio</button></a>
  </div>

  <!-- Modal -->
  <div id="modalConfirmacion" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%);
    background:white; padding:20px 30px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.2); z-index:999;">
    <p id="mensajeModal" style="font-size:16px; color:#2c3e50; text-align:center;">Producto eliminado</p>
  </div>

  <script>
    let total = 0;

    function mostrarCarro() {
      const contenedor = document.getElementById('carro-contenido');
      const totalGeneral = document.getElementById('totalGeneral');
      const carro = JSON.parse(localStorage.getItem('carro')) || [];

      contenedor.innerHTML = "";
      total = 0;

      if (carro.length === 0) {
        contenedor.innerHTML = '<p style="text-align:center;">No hay productos en el carro.</p>';
        totalGeneral.innerText = "Total: $0";
        return;
      }

      carro.forEach((item, index) => {
        const div = document.createElement('div');
        div.className = 'producto';
        const totalItem = item.precio * item.cantidad;
        total += totalItem;

        div.innerHTML = `
          <h3>${item.nombre}</h3>
          <p><strong>Precio:</strong> $${item.precio.toLocaleString()}</p>
          <p><strong>Cantidad:</strong> ${item.cantidad}</p>
          <p><strong>Total:</strong> $${totalItem.toLocaleString()}</p>
          <button onclick="eliminarProducto(${index}, '${item.nombre}')" style="margin-top:10px;">Eliminar</button>
        `;
        contenedor.appendChild(div);
      });

      totalGeneral.innerText = `Total: $${total.toLocaleString()}`;
    }

    function eliminarProducto(index, nombre) {
      let carro = JSON.parse(localStorage.getItem('carro')) || [];
      carro.splice(index, 1);
      localStorage.setItem('carro', JSON.stringify(carro));
      mostrarModal(`${nombre} eliminado del carro.`);
      mostrarCarro();
    }

    function finalizarCompra() {
      const carro = JSON.parse(localStorage.getItem('carro')) || [];
      if (carro.length === 0) {
        alert("El carro está vacío.");
        return;
      }

      let contenido = "Resumen de Compra - Ferremas\n\n";
      carro.forEach(item => {
        const subtotal = item.precio * item.cantidad;
        contenido += `Producto: ${item.nombre}\nCantidad: ${item.cantidad}\nPrecio unitario: $${item.precio.toLocaleString()}\nSubtotal: $${subtotal.toLocaleString()}\n\n`;
      });
      contenido += `TOTAL: $${total.toLocaleString()}\n\nGracias por su compra.`;

      const blob = new Blob([contenido], { type: "text/plain" });
      const enlace = document.createElement("a");
      enlace.href = URL.createObjectURL(blob);
      enlace.download = "resumen_compra_ferremas.txt";
      enlace.click();

      alert("¡Gracias por su compra!");
      localStorage.removeItem('carro');
      location.reload();
    }

    function vaciarCarro() {
      localStorage.removeItem('carro');
      location.reload();
    }

    function mostrarModal(mensaje) {
      const modal = document.getElementById('modalConfirmacion');
      const texto = document.getElementById('mensajeModal');
      texto.innerText = mensaje;
      modal.style.display = 'block';
      setTimeout(() => {
        modal.style.display = 'none';
      }, 1800);
    }

    mostrarCarro();
  </script>

</body>
</html>
